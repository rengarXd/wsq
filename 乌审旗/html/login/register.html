<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>注册页面</title>
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			html, body {
				background-image: url('../../image/wsqlogin.png');
				background-size: cover;
			}
			.error {
				position: fixed;
				top: 20px;
				right: 20px;
				color: #ffffff;
				font-size: 20px;
			}
		</style>
	</head>
	<body>
		<!--无网络登录和获取验证码优化-->
		<!--<div id="top_position" >
		<div class="chacha H-text-align-right H-theme-font-color-white">
		<i tapmode="H-touch-active" onclick="api.closeWin();" class="iconfont H-touch-active icon-chacha H-font-size-20"></i>
		</div>
		</div>-->
		<div class="top_part" style="height: 280px;"></div>
		<div class="H-padding-15">
			<div class="H-border-radius-5 H-flexbox-horizontal H-border-vertical-both-after H-theme-background-color-white">
				<input style="color:#49b1f4;" id="code" type="text" class="H-textbox H-vertical-align-middle H-width-100-percent H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-padding-horizontal-left-25" placeholder="请输入用户名...">
			</div>
			<div class="H-margin-vertical-top-8"></div>
			<div class="H-border-radius-5 H-flexbox-horizontal H-border-vertical-bottom-after H-theme-background-color-white">
				<input id="pwd_1" style="color:#49b1f4;" type="password" class="H-textbox H-vertical-align-middle H-vertical-middle H-width-100-percent H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-padding-horizontal-left-25" placeholder="请输入新密码...">
			</div>
			<div class="H-margin-vertical-top-8"></div>
			<div class="H-border-radius-5 H-flexbox-horizontal H-border-vertical-bottom-after H-theme-background-color-white">
				<input id="pwd_1" style="color:#49b1f4;" type="password" class="H-textbox H-vertical-align-middle H-vertical-middle H-width-100-percent H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-padding-horizontal-left-25" placeholder="请输入再输入一次密码...">
			</div>
			<div class="H-padding-horizontal-left-10 H-padding-vertical-top-5 H-flexbox-horizontal">
				<div class="H-flex-item">
					<input type="radio" name="a" class="H-radio H-radio-null H-vertical-align-middle H-font-size-18 H-theme-font-color-black">
					<span class="H-theme-font-color-white H-font-size-16">记住密码</span>
				</div>
				<div class="H-flex-item">
					<input type="radio" name="a" checked="checked" class="H-radio H-radio-null H-vertical-align-middle H-font-size-18 H-theme-font-color-black">
					<span class="H-theme-font-color-white H-font-size-16">记住密码</span>
				</div>
			</div>
			<div class="H-padding-horizontal-both-20 H-padding-vertical-top-10">
				<button onclick="checkCode();" class="H-touch-active xy_confirm_btn H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-border-none H-padding-vertical-both-12 H-padding-horizontal-both-20  H-theme-font-color-white ">
					注&nbsp;&nbsp;&nbsp;册
				</button>
			</div>
		</div>
		<script type="text/javascript" src="../../script/H.js"></script>
		<script type="text/javascript" src="../../script/zepto.min.js"></script>
		<script type="text/javascript" src="../../script/tools/availdate-v1.0.2.js"></script>
		<script type="text/javascript">
			var user_name = null, user_password = null;
			H.ready(function() {
				ac.form({
					area : "#availdate",
					btn : "#register", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
					startCheck : function() {
						// 自定义验证之前执行函数
						//alert("开始验证啦！一般用于加载！");
					},
					singleError : function(e, msg) {
						// 自定义弹窗格式###############
						api.alert({
							title : "温馨提示",
							msg : msg
						}, function(ret, err) {
						});
					},
					singleSuccess : function(e, msg) {
						// 验证单个成功之后提示信息
						//alert("我自己通过验证了！别人我不知道！");
					},
					endSuccess : function(data) {
						var cole_no = $("#cole_no").attr("types");
						var tel = $("#mob_code").val();
						var user_realname = $("#user_name").val();
						var email = $("#email").val();
						var user_password = $("#user_pwd").val();
						api.showProgress({
							title : '注册中',
							text : '请稍等....',
						});
						//post请求
						api.ajax({
							url : window.serverUrl + 'register&funid=sys_user',
							method : 'post',
							data : {
								values : {
									user_code : user_name,
									user_pwd : user_password,
									role_no : cole_no,
									user_name : user_realname,
									mob_code : tel,
									email : email
								}
							}
						}, function(ret, err) {
							//							console.log(JSON.stringify(ret));
							//							console.log(JSON.stringify(err));
							api.hideProgress();
							var systemType = api.systemType;
							if (systemType == "ios") {
								var rets = eval('(' + err.body + ')');
								if (rets && rets.success == true) {
									api.toast({
										msg : '注册成功，即将跳转登录页面'
									});
									api.openWin({
										name : 'login_body',
										url : '../login/login_body.html'
									});
									//1.登录成功之后延时关闭自已
									setTimeout(function() {
										H.closeWin();
									}, 1200);
								} else if (err) {
									api.toast({
										msg : '注册失败'
									});
								}
							} else {
								if (ret && ret.success == true) {
									alert("注册成功");
									api.openWin({
										name : 'login_body',
										url : '../login/login_body.html'
									});
									//1.登录成功之后延时关闭自已
									setTimeout(function() {
										H.closeWin();
									}, 1200);
								} else if (err) {
									api.toast({
										msg : '注册失败'
									});
								}
							}
						});
					}
				});
				api.addEventListener({
					name : 'choise_type'
				}, function(ret, err) {
					if (ret && ret.value.id == '07') {
						$("#cole_no").attr("types", "07");
						$("#cole_no").text("一般纳税人");
					} else if (ret.value.id == '08') {
						$("#cole_no").attr("types", "08");
						$("#cole_no").text("房产经纪人")
					}
				});
			});
			//当输入密码框获取焦点时
			$("#user_pwd").focus(function() {
				user_name = $("#user_code").val();
				var b = /^[a-zA-Z0-9_]{6,16}$/
				if (!user_name.match(b)) {
					api.toast({
						msg : '用户名必须是由字母和数字组成的长度为6到16位的任意组合'
					});
				} else {
					//获取用户信息
					api.ajax({
						url : window.serverUrl + 'valusername&funid=sys_user&user_code=' + user_name,
					}, function(ret, err) {
						if (ret && ret.success == false) {//请求返回success值为false时
							api.toast({
								msg : '抱歉此用户名已被使用，请更换其它用户名'
							});
							$("#user_code").focus();
						}
					});
				}
			});
			/*纳税身份选择*/
			function select() {
				api.openFrame({
					name : 'choicetype_body',
					url : '../main/choicetype/choicetype_body.html',
					bounces : false,
					vScrollBarEnabled : false,
					hScrollBarEnabled : false
				})
				//				api.actionSheet({
				//					title : '请选择纳税身份',
				//					buttons : ['一般纳税人', '房产经纪人']
				//				}, function(ret, err) {
				//					if (ret && ret.buttonIndex == 1) {
				//						$("#cole_no").attr("types", "07");
				//						$("#cole_no").text("一般纳税人");
				//					} else if (ret && ret.buttonIndex == 2) {
				//						$("#cole_no").attr("types", "08");
				//						$("#cole_no").text("房产经纪人")
				//					} else {
				//						$("#cole_no").attr("types", "07");
				//						$("#cole_no").text("一般纳税人");
				//					}
				//				});
			}

			/*关闭本页*/
			function gb() {
				api.closeWin({
				});
			}
		</script>
	</body>
</html>